apiVersion: eevee.bot/v1alpha1
kind: NatsCluster
metadata:
  name: nats-cluster
  namespace: my-eevee-bot
spec:
  #
  # See https://artifacthub.io/packages/helm/nats/nats for full configuration options
  #
  namespaceOverride: my-eevee-bot
  container:
    env:
      TOKEN:
        valueFrom:
          secretKeyRef:
            name: nats-auth
            key: token
    merge:
      resources:
        requests:
          cpu: "2"
          memory: 4Gi
        limits:
          cpu: "2"
          memory: 4Gi
  config:
    cluster:
      enabled: true
      port: 6222
      replicas: 1

    jetstream:
      enabled: false

    nats:
      port: 4222

    leafnodes:
      enabled: false

    websocket:
      enabled: false

    mqtt:
      enabled: false

    gateway:
      enabled: false

    monitor:
      enabled: true
      port: 8222

    profiling:
      enabled: false
      port: 65432

    resolver:
      enabled: false

    merge:
      authorization:
        token: << $TOKEN >>
    patch: []

  reloader:
    enabled: true

  promExporter:
    enabled: true
    podMonitor:
      enabled: true

  service:
    enabled: true
    name: nats
    ports:
      nats:
        enabled: true
      leafnodes:
        enabled: true
      websocket:
        enabled: true
      mqtt:
        enabled: true
      cluster:
        enabled: true
      gateway:
        enabled: true
      monitor:
        enabled: true
      profiling:
        enabled: true

  # pod disruption budget
  podDisruptionBudget:
    enabled: true

  # service account
  serviceAccount:
    enabled: true

  natsBox:
    enabled: false # eevee-toolbox has NATS client included
